---
output: 
  github_document
bibliography: inst\\REFERENCES.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  eval = TRUE
)
```

# irpeat <img src='man/figures/logo-hex.png' align="right" height="139" alt="logo" style="float:right; height:200px;" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->


## Overview

'irpeat' is an R package which contains functions to analyze infrared spectra of peat samples. These functions are functions to compute humification indices and functions to predict peat properties. Some functions may also work with organic matter samples in general.

The following peat properties can be predicted (note model-specific limitations described in the documentation): 

+ Elemental contents (C, H, N, O, S, P, K, Ti)
+ isotope values (&delta;<sup>13</sup>C and &delta;<sup>15</sup>N)
+ physical properties (bulk density, volume fraction of solids, non-macroporosity, macroporosity, saturated hydraulic conductivity, specific heat capacity, dry thermal conductivity)
+ standard Gibbs free energy of formation (&Delta;G<sub>f</sub><sup>0</sup>) 
+ electrochemical properties (electron accepting capacity, electron donating capacity)
+ microbial nitrogen content (modified version of the model described in @Reuter.2020)
+ The degree of decomposition ($\gamma$, the fraction of initial mass lost).

The package also contains functions to predict holocellulose and Klason lignin contents [@Hodgkins.2018; @Teickner.2022f], but these models are biased for peat samples [@Teickner.2022f].


### How to install

You can install 'irpeat' from GitHub using R via:

```{r installation, eval = FALSE}
remotes::install_github(repo = "henningte/irpeat")
```

'irpeat' relies on the R package ['ir'](https://github.com/henningte/ir) for handling infrared spectra.

If you want to use the prediction models, you have to install the ['irpeatmodels'](https://doi.org/10.5281/zenodo.17187912) package [@Teickner.2025g] in addition to the 'irpeat' package:

```{r installation-irpeatmodels, eval=FALSE}
remotes::install_url("https://zenodo.org/record/17187912/files/irpeatmodels_0.1.0.tar.gz", type = "source")
```


### How to use

You can load 'irpeat' in R with:

```{r load_irpeat}
library(irpeat)

# load additional packages needed for this tutorial
library(ir)
library(irpeatmodels)
library(ggplot2)
library(units)
library(rstan)
```

You can test 'irpeat' with sample data from the R package 'irpeat':

```{r ir_sample_data_load}
irpeat::irpeat_sample_data
```

`irpeat_sample_data` contains transmission mid-infrared spectra of peat different samples (See @Teickner.2022 and @Teickner.2021c for details).

A simple workflow could be, for example, to baseline correct the spectra (using functions of the package 'ir') compute various humification indices and Klason lignin and holocellulose mass fractions in the samples.

```{r sample_data_workflow, warning=FALSE}
set.seed(3453)
x <- 
  irpeat_sample_data |>                                  # data
  dplyr::mutate(
    hi_1630_1090 =
      irpeat_sample_data |>
      ir::ir_bc(method = "rubberband") |>                # baseline correction
      ir::ir_interpolate(start = NULL, dw = 1) |>        # interpolation
      irp_hi(x1 = 1630, x2 = 1090) |>                    # humification index
      dplyr::pull(hi_1630_1090)
  ) |>
  ir::ir_interpolate(start = NULL, dw = 1) |>
  irpeat::irp_nitrogen_content_1(do_summary = TRUE) |>   # N content
  irpeat::irp_bulk_density_1(do_summary = TRUE) |>       # bulk density
  irpeat::irp_macroporosity_1(do_summary = TRUE)         # macroporosity
```

`x` is identical to `irpeat_sample_data`, but contains an additional column for the computed humification index (`h1_1630_1090`) and the computed nitrogen content (`nitrogen_content_1`)

```{r x_inspect}
x
```

Plot of the humification index (ratio of the intensities at 1420 and 1090 cm<sup>-1</sup> [@Broder.2012]) versus the Klason lignin content:

```{r x_plot}
x |>
  ggplot(
    aes(
      x = 
        nitrogen_content_1 |>
        units::set_units(value = "%") |>
        quantities::drop_quantities(), 
      y = 
        hi_1630_1090
    )
  ) + 
  geom_point() +
  labs(
    x = "Nitrogen content [mass %]", 
    y = expression("Ratio of the intensities at"~1630~and~1090~cm^{-1})
  )
```


All computed quantities come with units and standard errors (thanks to the [quantities](https://github.com/r-quantities/quantities) package):

```{r x_nitrogen_inspect_quantities}
x$nitrogen_content_1[1:5]
```


### How to cite

Please cite this R package as:

> Henning Teickner, Suzanne B. Hodgkins (`r format(Sys.Date(), "%Y")`). _irpeat: Functions to Analyze Mid-Infrared Spectra of Peat Samples_. Accessed `r format(Sys.Date(), "%Y-%m-%d")`. Online at <https://github.com/henningte/irpeat>.


### Licenses

**Text and figures :**  [CC-BY-4.0](https://creativecommons.org/licenses/by/4.0/)

**Code :** See the [DESCRIPTION](DESCRIPTION) file

**Data :** [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) attribution requested in reuse. See the sources section for data sources and how to give credit to the original author(s) and the source.

### Contributions

We welcome contributions from everyone. Before you get started, please see our [contributor guidelines](CONTRIBUTING.md). Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). By participating in this project you agree to abide by its terms.

### Sources

The data and prediction models for holocellulose and Klason lignin (`irp_content_h_hodgkins_model`, `irp_content_kl_hodgkins_model`) are derived from @Hodgkins.2018 and were restructured to match the requirements of ir. The original article containing the data can be downloaded from https://www.nature.com/articles/s41467-018-06050-2 and is distributed under the Creative Commons Attribution 4.0 International License (https://creativecommons.org/licenses/by/4.0/). The data on Klason lignin and holocellulose content was originally derived from @DelaCruz.2016.

Modified prediction models for holocellulose and Klason lignin (`model_holocellulose_2`, `model_klason_lignin_2`) are derived from @Teickner.2022f.

Data and models for the electrochemical accepting and donating capacities (EAC, EDC) of peat were derived from @Teickner.2022 and @Teickner.2021c

This packages was developed in R (`r R.Version()$version.string`) [@RCoreTeam.2020] using functions from devtools [@Wickham.2021], usethis [@Wickham.2022], and roxygen2 [@Wickham.2022a].

### References
